All the functions here are not written by myself.

Most are written by Andrea Bellome.